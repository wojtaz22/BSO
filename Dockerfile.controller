# Dockerfile.controller
FROM registry.community.greenbone.net/community/gvm-tools:stable

# 1) Przełączamy się na root i instalujemy brakujące narzędzia
USER root
RUN apt-get update \
  && apt-get install -y --no-install-recommends \
       iproute2 nmap msmtp-mta libxml2-utils \
  && rm -rf /var/lib/apt/lists/*

# 2) Kopiujemy nasze skrypty do /opt/scripts i nadajemy prawa
COPY scripts /opt/scripts
WORKDIR /opt/scripts
RUN chmod +x discover-lan-hosts.sh auto_scan.sh

# 3) Wracamy na nie-rootowego użytkownika (uid 1001:1001 jest używany w gvm-tools)
USER 1001:1001

# 4) Domyślny entrypoint to nasz auto_scan.sh
ENTRYPOINT ["./auto_scan.sh"]
